[unix] skip 'Windows only'

# test that chezmoi apply runs Batch scripts
exec chezmoi apply
unix2dos golden/stdout # normalize line endings before comparison
cmp stdout golden/stdout

chhome home2/user

# test that chezmoi apply runs PowerShell scripts
exec chezmoi apply
unix2dos golden/stdout2 # normalize line endings before comparison
cmp stdout golden/stdout2

chhome home3/user

# test that interpreters can be overridden
exec chezmoi apply
unix2dos golden/stdout3 # normalize line endings before comparison
cmp stdout golden/stdout3

-- bin/fake-python3.bat --
@echo Hello from fake Python
-- golden/stdout --
Hello from Batch (.bat)
Hello from Batch (.cmd)
-- golden/stdout2 --
Hello from PowerShell
-- golden/stdout3 --
Hello from fake Python
-- golden/stdout_override --
Hello from overridden PowerShell interpreter
-- golden/stdout_powershell --
Hello from Windows PowerShell
-- golden/stdout_pwsh --
Hello from PowerShell Core (pwsh)
-- home/user/.local/share/chezmoi/run_batch_script.bat --
@echo Hello from Batch (.bat)
-- home/user/.local/share/chezmoi/run_cmd_script.cmd --
@echo Hello from Batch (.cmd)
-- home2/user/.local/share/chezmoi/run_powershell_script.ps1 --
Write-Host 'Hello from PowerShell'
-- home3/user/.config/chezmoi/chezmoi.toml --
[interpreters.py]
    command = "fake-python3"
-- home3/user/.local/share/chezmoi/run_python_script.py --
#!/usr/bin/env python3

# this should never be executed as the interpreter is overridden with
# fake-python3.bat in the config file
fail()

# test: pwsh available, should use pwsh
# (mock FindExecutable to return pwsh.exe path)
chhome home_pwsh/user
exec chezmoi apply
cmp stdout golden/stdout_pwsh

# test: powershell available, pwsh not, should use powershell
# (mock FindExecutable to return powershell.exe path)
chhome home_powershell/user
exec chezmoi apply
cmp stdout golden/stdout_powershell

# test: interpreters.ps1 config overrides default selection
chhome home_override/user
exec chezmoi apply
cmp stdout golden/stdout_override

-- home_override/user/.config/chezmoi/chezmoi.toml --
[interpreters.ps1]
    command = "custom-powershell"
    args = ["-CustomArg"]

-- home_override/user/.local/share/chezmoi/run_powershell_script.ps1 --
Write-Host 'Hello from overridden PowerShell interpreter'
-- home_powershell/user/.local/share/chezmoi/run_powershell_script.ps1 --
Write-Host 'Hello from Windows PowerShell'
-- home_pwsh/user/.local/share/chezmoi/run_powershell_script.ps1 --
Write-Host 'Hello from PowerShell Core (pwsh)'
