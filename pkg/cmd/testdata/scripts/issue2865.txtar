[!exec:git] skip 'git not found in $PATH'

mkgitconfig
mkhomedir golden
mkhomedir

# create a commit
exec chezmoi git init
cp golden/chezmoiroot  $CHEZMOISOURCEDIR/.chezmoiroot
mkdir $CHEZMOISOURCEDIR/home
mkdir $CHEZMOISOURCEDIR/home/.chezmoiscripts
cp golden/chezmoi.toml $CHEZMOISOURCEDIR/home/.chezmoi.toml.tmpl
cp golden/run_once_echo.sh $CHEZMOISOURCEDIR/home/.chezmoiscripts/run_once_echo.sh.tmpl
exec chezmoi git add .
exec chezmoi git commit -- --message 'Initial commit'

chhome home2/user

# test that .chezmoi.sourceDir is set correctly when .chezmoiroot is present (chezmoi init --apply in a clean home directory)
mkgitconfig
exec chezmoi init --apply file://$WORK/home/user/.local/share/chezmoi
stdout ${CHEZMOISOURCEDIR@R}/home

# test that .chezmoi.sourceDir is set correctly in config file
exec chezmoi execute-template '{{ .testDir }}'
stdout ${CHEZMOISOURCEDIR@R}/home

-- golden/chezmoi.toml --
[data]
  testDir="{{ .chezmoi.sourceDir }}"
-- golden/chezmoiroot --
home
-- golden/run_once_echo.sh --
#!/bin/sh

echo "{{ .chezmoi.sourceDir }}"
