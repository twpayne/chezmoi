# Generated by go2rpm 1.17.1
%bcond check 1

%global release_commit {{ .Commit }}

# https://github.com/twpayne/chezmoi
%global goipath         github.com/twpayne/chezmoi
Version:                {{ .RawVersion }}

%gometa -L -f

Name:           chezmoi
Release:        %autorelease
Summary:        Manage your dotfiles across multiple diverse machines

License:        MIT
URL:            %{gourl}
Source:         chezmoi-{{ .Version }}.tar.gz

%description
Manage your dotfiles across multiple diverse machines, securely.

%prep
%goprep -A
%setup -q -T -D -a1 %{forgesetupargs}
%autopatch -p1

%generate_buildrequires

%build
%global gomodulesmode GO111MODULE=on
export GO_LDFLAGS="-X main.version=%{version} \
                   -X main.commit=%{release_commit} \
                   -X main.date=$(date -d "@${SOURCE_DATE_EPOCH}" +%Y-%m-%dT%H:%M:%SZ) \
                   -X main.builtBy=srpm"
export BUILDTAGS="noupgrade"
%gobuild -o %{gobuilddir}/bin/chezmoi %{goipath}

%install
install -m 0755 -vd                     %{buildroot}%{_bindir}
install -m 0755 -vp %{gobuilddir}/bin/* %{buildroot}%{_bindir}/

install -Dpm 0644 completions/chezmoi-completion.bash %{buildroot}%{bash_completions_dir}/%{name}
install -Dpm 0644 completions/%{name}.fish %{buildroot}%{fish_completions_dir}/%{name}.fish
install -Dpm 0644 completions/%{name}.zsh  %{buildroot}%{zsh_completions_dir}/_%{name}

%check
%if %{with check}
%gotest ./...
%endif

%doc README.md
%{_bindir}/chezmoi
%{bash_completions_dir}/%{name}
%{fish_completions_dir}/%{name}.fish
%{zsh_completions_dir}/_%{name}

%changelog
%autochangelog
